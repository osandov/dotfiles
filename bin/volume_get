#!/bin/sh

CHANNELS=$(amixer get Master | sed -nr 's/\s*Playback channels:\s*(.*)/\1/p' | sed 's/\s*-\s*/;/g')
TOTAL_VOLUME=0
NUM_CHANNELS=0
IFS=';'
for CHANNEL in $CHANNELS; do
    VOLUME=$(amixer get Master | sed -nr "s/\s*${CHANNEL}.*\[(.*)%\].*/\1/p")
    TOTAL_VOLUME=$(($TOTAL_VOLUME + $VOLUME))
    NUM_CHANNELS=$(($NUM_CHANNELS + 1))
    if ! amixer get Master | fgrep '[on]' > /dev/null; then
        MUTED=true
    fi
done
VOLUME=$(($TOTAL_VOLUME / $NUM_CHANNELS))

if [ -z "$MUTED" ]; then
    echo "$VOLUME"
else
    echo MUTE
fi
