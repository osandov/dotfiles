#!/bin/sh

open_session () {
    NEW_SESSION=0
    while true; do
        if ! tmux has-session -t $NEW_SESSION 2> /dev/null; then
            # This also handles the case where there is no server yet
            echo $NEW_SESSION
            break
        fi
        NEW_SESSION=$(expr $NEW_SESSION + 1)
    done
}

NEW_SESSION=$(open_session)
tmux new -s $NEW_SESSION \; set -q destroy-unattached
